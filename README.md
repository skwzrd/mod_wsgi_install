# Hosting A Dynamically Generate Site with Apache on Ubuntu Using mod_wsgi

## Introduction

For this guide, I am using

- Ubuntu 22.04
- Apache/2.4.52
- Python 3.10.4

In the following instructions, replace `bionicbeaver` with your own domain name.

At the end of this guide, you will have a site accessible 

## Part One

### Serving a static HTML file locally.

Go to Wired Settings, select IPV4, set the IPV4 Method to `Manual` and enter in your desired IP address (192.168.0.##), your netmask (255.255.255.0 will work) and your gateway IP address (found on your router labeled as "web address").

**Note**: You can find your current IP address using `hostname -I`.

Open a browser, visit your router's web address, and make a DHCP Reservation for your computer in order to give it a static IP address.

`sudo apt update`

`sudo apt install apache2`

Add the following lines to the file `/etc/hosts` mapping your IP address to your domain name.

```conf
192.168.0.XX www.bionicbeaver.com
192.168.0.XX bionicbeaver.com
```

`cd /etc/apache2/sites-available`

Create a file called `/etc/apache2/sites-available/bionicbeaver.com.conf` with the following contents:

```conf
<VirtualHost *:80>

  ServerName  www.bionicbeaver.com
  ServerAlias bionicbeaver.com  *.bionicbeaver.com
  ServerAdmin bionicbeaver@bionicbeaver.com

  DocumentRoot /var/www/html/bionicbeaver

  ErrorLog ${APACHE_LOG_DIR}/error.log
  CustomLog ${APACHE_LOG_DIR}/access.log combined

</VirtualHost>
```

`sudo a2dissite 000-default.conf`

`sudo a2ensite bionicbeaver.com.conf`

`sudo rm /var/www/html/index.html`

`sudo mkdir -p /var/www/html/bionicbeaver.com`

`sudo chown -R $USER:$USER /var/www/html/bionicbeaver.com`

`sudo chmod -R 755 /var/www`


Make a file `/var/www/html/bionicbeaver/index.html` with the contents:

```html
<html>
  <head>
    <title>Welcome to bionicbeaver.com!</title>
  </head>
  <body>
    <h1>Success!</h1>
    <p>The bionicbeaver.com virtual host is working!</p>
  </body>
</html>
```

`sudo apache2ctl configtest`

`systemctl restart apache2`

At this point, when you visit [bionicbeaver.com](bionicbeaver.com) in your browser, you should see the page from `var/www/html/bionicbeaver/index.html`.

**References**:

- [How To Set Up Apache Virtual Hosts on Ubuntu 20.04](https://www.digitalocean.com/community/tutorials/how-to-set-up-apache-virtual-hosts-on-ubuntu-20-04)

## Part Two

### Serving Dynamic Content with WSGI/Python

`sudo apt-get install apache2-dev python3-dev  python3-distutils`

Download mod_wsgi from [here](https://github.com/GrahamDumpleton/mod_wsgi/releases).

`tar xvfz mod_wsgi-X.Y.tar.gz`

`cd mod_wsgi-X.Y`

`./configure --with-python=/usr/bin/python3`

`make`

`sudo make install`

Add the line `LoadModule wsgi_module /usr/lib/apache2/modules/mod_wsgi.so` to `/etc/apache2/mods-available/wsgi.load` if it doesn't exist.

`sudo a2enmod wsgi`

`sudo mkdir /usr/local/www/wsgi-scripts/bionicbeaver`

Create a file called `/usr/local/www/wsgi-scripts/bionicbeaver/bionicbeaver.py` and enter the following contents:

```python
def application(environ, start_response):
    status = '200 OK'
    output = b'Hello from bionicbeaver\'s dynamic page!'

    response_headers = [
        ('Content-type', 'text/plain'),
        ('Content-Length', str(len(output)))
    ]
    start_response(status, response_headers)

    return [output]
```

Add the following to the very bottom of `/etc/apache2/sites-available/bionicbeaver.com.conf`.

```conf
WSGIScriptAlias / /usr/local/www/wsgi-scripts/bionicbeaver/bionicbeaver.py
<Directory /usr/local/www/wsgi-scripts/bionicbeaver>
    Require all granted
</Directory>
```

`systemctl restart apache2`

If you visit [bionicbeaver.com](bionicbeaver.com), you should now see the dynamic page generated by mod_wsgi/Python.

**References**:

- [Quick Installation Guide](https://modwsgi.readthedocs.io/en/master/user-guides/quick-installation-guide.html)
- [apache - wsgi - python - basic example](https://stackoverflow.com/a/41827304/9576988)
